{"ast":null,"code":"/**\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\nvar sprintf = require('./sprintf').sprintf;\n\nvar utils = require('./utils');\n\nvar SyntaxError = require('./errors').SyntaxError;\n\nvar _cache = {};\nvar RE = new RegExp(\"(\" + \"'[^']*'|\\\"[^\\\"]*\\\"|\" + \"::|\" + \"//?|\" + \"\\\\.\\\\.|\" + \"\\\\(\\\\)|\" + \"[/.*:\\\\[\\\\]\\\\(\\\\)@=])|\" + \"((?:\\\\{[^}]+\\\\})?[^/\\\\[\\\\]\\\\(\\\\)@=\\\\s]+)|\" + \"\\\\s+\", 'g');\nvar xpath_tokenizer = utils.findall.bind(null, RE);\n\nfunction prepare_tag(next, token) {\n  var tag = token[0];\n\n  function select(context, result) {\n    var i,\n        len,\n        elem,\n        rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n\n      elem._children.forEach(function (e) {\n        if (e.tag === tag) {\n          rv.push(e);\n        }\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_star(next, token) {\n  function select(context, result) {\n    var i,\n        len,\n        elem,\n        rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n\n      elem._children.forEach(function (e) {\n        rv.push(e);\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_dot(next, token) {\n  function select(context, result) {\n    var i,\n        len,\n        elem,\n        rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      rv.push(elem);\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_iter(next, token) {\n  var tag;\n  token = next();\n\n  if (token[1] === '*') {\n    tag = '*';\n  } else if (!token[1]) {\n    tag = token[0] || '';\n  } else {\n    throw new SyntaxError(token);\n  }\n\n  function select(context, result) {\n    var i,\n        len,\n        elem,\n        rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      elem.iter(tag, function (e) {\n        if (e !== elem) {\n          rv.push(e);\n        }\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_dot_dot(next, token) {\n  function select(context, result) {\n    var i,\n        len,\n        elem,\n        rv = [],\n        parent_map = context.parent_map;\n\n    if (!parent_map) {\n      context.parent_map = parent_map = {};\n      context.root.iter(null, function (p) {\n        p._children.forEach(function (e) {\n          parent_map[e] = p;\n        });\n      });\n    }\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n\n      if (parent_map.hasOwnProperty(elem)) {\n        rv.push(parent_map[elem]);\n      }\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_predicate(next, token) {\n  var tag, key, value, select;\n  token = next();\n\n  if (token[1] === '@') {\n    // attribute\n    token = next();\n\n    if (token[1]) {\n      throw new SyntaxError(token, 'Invalid attribute predicate');\n    }\n\n    key = token[0];\n    token = next();\n\n    if (token[1] === ']') {\n      select = function (context, result) {\n        var i,\n            len,\n            elem,\n            rv = [];\n\n        for (i = 0, len = result.length; i < len; i++) {\n          elem = result[i];\n\n          if (elem.get(key)) {\n            rv.push(elem);\n          }\n        }\n\n        return rv;\n      };\n    } else if (token[1] === '=') {\n      value = next()[1];\n\n      if (value[0] === '\"' || value[value.length - 1] === '\\'') {\n        value = value.slice(1, value.length - 1);\n      } else {\n        throw new SyntaxError(token, 'Ivalid comparison target');\n      }\n\n      token = next();\n\n      select = function (context, result) {\n        var i,\n            len,\n            elem,\n            rv = [];\n\n        for (i = 0, len = result.length; i < len; i++) {\n          elem = result[i];\n\n          if (elem.get(key) === value) {\n            rv.push(elem);\n          }\n        }\n\n        return rv;\n      };\n    }\n\n    if (token[1] !== ']') {\n      throw new SyntaxError(token, 'Invalid attribute predicate');\n    }\n  } else if (!token[1]) {\n    tag = token[0] || '';\n    token = next();\n\n    if (token[1] !== ']') {\n      throw new SyntaxError(token, 'Invalid node predicate');\n    }\n\n    select = function (context, result) {\n      var i,\n          len,\n          elem,\n          rv = [];\n\n      for (i = 0, len = result.length; i < len; i++) {\n        elem = result[i];\n\n        if (elem.find(tag)) {\n          rv.push(elem);\n        }\n      }\n\n      return rv;\n    };\n  } else {\n    throw new SyntaxError(null, 'Invalid predicate');\n  }\n\n  return select;\n}\n\nvar ops = {\n  \"\": prepare_tag,\n  \"*\": prepare_star,\n  \".\": prepare_dot,\n  \"..\": prepare_dot_dot,\n  \"//\": prepare_iter,\n  \"[\": prepare_predicate\n};\n\nfunction _SelectorContext(root) {\n  this.parent_map = null;\n  this.root = root;\n}\n\nfunction findall(elem, path) {\n  var selector, result, i, len, token, value, select, context;\n\n  if (_cache.hasOwnProperty(path)) {\n    selector = _cache[path];\n  } else {\n    // TODO: Use smarter cache purging approach\n    if (Object.keys(_cache).length > 100) {\n      _cache = {};\n    }\n\n    if (path.charAt(0) === '/') {\n      throw new SyntaxError(null, 'Cannot use absolute path on element');\n    }\n\n    result = xpath_tokenizer(path);\n    selector = [];\n\n    function getToken() {\n      return result.shift();\n    }\n\n    token = getToken();\n\n    while (true) {\n      var c = token[1] || '';\n      value = ops[c](getToken, token);\n\n      if (!value) {\n        throw new SyntaxError(null, sprintf('Invalid path: %s', path));\n      }\n\n      selector.push(value);\n      token = getToken();\n\n      if (!token) {\n        break;\n      } else if (token[1] === '/') {\n        token = getToken();\n      }\n\n      if (!token) {\n        break;\n      }\n    }\n\n    _cache[path] = selector;\n  } // Execute slector pattern\n\n\n  result = [elem];\n  context = new _SelectorContext(elem);\n\n  for (i = 0, len = selector.length; i < len; i++) {\n    select = selector[i];\n    result = select(context, result);\n  }\n\n  return result || [];\n}\n\nfunction find(element, path) {\n  var resultElements = findall(element, path);\n\n  if (resultElements && resultElements.length > 0) {\n    return resultElements[0];\n  }\n\n  return null;\n}\n\nfunction findtext(element, path, defvalue) {\n  var resultElements = findall(element, path);\n\n  if (resultElements && resultElements.length > 0) {\n    return resultElements[0].text;\n  }\n\n  return defvalue;\n}\n\nexports.find = find;\nexports.findall = findall;\nexports.findtext = findtext;","map":{"version":3,"sources":["/Users/Cooper/Bluxury_Catering/bluxury-catering copy 4/src/ecpay_payment_nodejs/node_modules/elementtree/lib/elementpath.js"],"names":["sprintf","require","utils","SyntaxError","_cache","RE","RegExp","xpath_tokenizer","findall","bind","prepare_tag","next","token","tag","select","context","result","i","len","elem","rv","length","_children","forEach","e","push","prepare_star","prepare_dot","prepare_iter","iter","prepare_dot_dot","parent_map","root","p","hasOwnProperty","prepare_predicate","key","value","get","slice","find","ops","_SelectorContext","path","selector","Object","keys","charAt","getToken","shift","c","element","resultElements","findtext","defvalue","text","exports"],"mappings":"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","sourcesContent":["/**\n *  Copyright 2011 Rackspace\n *\n *  Licensed under the Apache License, Version 2.0 (the \"License\");\n *  you may not use this file except in compliance with the License.\n *  You may obtain a copy of the License at\n *\n *      http://www.apache.org/licenses/LICENSE-2.0\n *\n *  Unless required by applicable law or agreed to in writing, software\n *  distributed under the License is distributed on an \"AS IS\" BASIS,\n *  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n *  See the License for the specific language governing permissions and\n *  limitations under the License.\n *\n */\n\nvar sprintf = require('./sprintf').sprintf;\n\nvar utils = require('./utils');\nvar SyntaxError = require('./errors').SyntaxError;\n\nvar _cache = {};\n\nvar RE = new RegExp(\n  \"(\" +\n  \"'[^']*'|\\\"[^\\\"]*\\\"|\" +\n  \"::|\" +\n  \"//?|\" +\n  \"\\\\.\\\\.|\" +\n  \"\\\\(\\\\)|\" +\n  \"[/.*:\\\\[\\\\]\\\\(\\\\)@=])|\" +\n  \"((?:\\\\{[^}]+\\\\})?[^/\\\\[\\\\]\\\\(\\\\)@=\\\\s]+)|\" +\n  \"\\\\s+\", 'g'\n);\n\nvar xpath_tokenizer = utils.findall.bind(null, RE);\n\nfunction prepare_tag(next, token) {\n  var tag = token[0];\n\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      elem._children.forEach(function(e) {\n        if (e.tag === tag) {\n          rv.push(e);\n        }\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_star(next, token) {\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      elem._children.forEach(function(e) {\n        rv.push(e);\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_dot(next, token) {\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      rv.push(elem);\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_iter(next, token) {\n  var tag;\n  token = next();\n\n  if (token[1] === '*') {\n    tag = '*';\n  }\n  else if (!token[1]) {\n    tag = token[0] || '';\n  }\n  else {\n    throw new SyntaxError(token);\n  }\n\n  function select(context, result) {\n    var i, len, elem, rv = [];\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n      elem.iter(tag, function(e) {\n        if (e !== elem) {\n          rv.push(e);\n        }\n      });\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\nfunction prepare_dot_dot(next, token) {\n  function select(context, result) {\n    var i, len, elem, rv = [], parent_map = context.parent_map;\n\n    if (!parent_map) {\n      context.parent_map = parent_map = {};\n\n      context.root.iter(null, function(p) {\n        p._children.forEach(function(e) {\n          parent_map[e] = p;\n        });\n      });\n    }\n\n    for (i = 0, len = result.length; i < len; i++) {\n      elem = result[i];\n\n      if (parent_map.hasOwnProperty(elem)) {\n        rv.push(parent_map[elem]);\n      }\n    }\n\n    return rv;\n  }\n\n  return select;\n}\n\n\nfunction prepare_predicate(next, token) {\n  var tag, key, value, select;\n  token = next();\n\n  if (token[1] === '@') {\n    // attribute\n    token = next();\n\n    if (token[1]) {\n      throw new SyntaxError(token, 'Invalid attribute predicate');\n    }\n\n    key = token[0];\n    token = next();\n\n    if (token[1] === ']') {\n      select = function(context, result) {\n        var i, len, elem, rv = [];\n\n        for (i = 0, len = result.length; i < len; i++) {\n          elem = result[i];\n\n          if (elem.get(key)) {\n            rv.push(elem);\n          }\n        }\n\n        return rv;\n      };\n    }\n    else if (token[1] === '=') {\n      value = next()[1];\n\n      if (value[0] === '\"' || value[value.length - 1] === '\\'') {\n        value = value.slice(1, value.length - 1);\n      }\n      else {\n        throw new SyntaxError(token, 'Ivalid comparison target');\n      }\n\n      token = next();\n      select = function(context, result) {\n        var i, len, elem, rv = [];\n\n        for (i = 0, len = result.length; i < len; i++) {\n          elem = result[i];\n\n          if (elem.get(key) === value) {\n            rv.push(elem);\n          }\n        }\n\n        return rv;\n      };\n    }\n\n    if (token[1] !== ']') {\n      throw new SyntaxError(token, 'Invalid attribute predicate');\n    }\n  }\n  else if (!token[1]) {\n    tag = token[0] || '';\n    token = next();\n\n    if (token[1] !== ']') {\n      throw new SyntaxError(token, 'Invalid node predicate');\n    }\n\n    select = function(context, result) {\n      var i, len, elem, rv = [];\n\n      for (i = 0, len = result.length; i < len; i++) {\n        elem = result[i];\n\n        if (elem.find(tag)) {\n          rv.push(elem);\n        }\n      }\n\n      return rv;\n    };\n  }\n  else {\n    throw new SyntaxError(null, 'Invalid predicate');\n  }\n\n  return select;\n}\n\n\n\nvar ops = {\n  \"\": prepare_tag,\n  \"*\": prepare_star,\n  \".\": prepare_dot,\n  \"..\": prepare_dot_dot,\n  \"//\": prepare_iter,\n  \"[\": prepare_predicate,\n};\n\nfunction _SelectorContext(root) {\n  this.parent_map = null;\n  this.root = root;\n}\n\nfunction findall(elem, path) {\n  var selector, result, i, len, token, value, select, context;\n\n  if (_cache.hasOwnProperty(path)) {\n    selector = _cache[path];\n  }\n  else {\n    // TODO: Use smarter cache purging approach\n    if (Object.keys(_cache).length > 100) {\n      _cache = {};\n    }\n\n    if (path.charAt(0) === '/') {\n      throw new SyntaxError(null, 'Cannot use absolute path on element');\n    }\n\n    result = xpath_tokenizer(path);\n    selector = [];\n\n    function getToken() {\n      return result.shift();\n    }\n\n    token = getToken();\n    while (true) {\n      var c = token[1] || '';\n      value = ops[c](getToken, token);\n\n      if (!value) {\n        throw new SyntaxError(null, sprintf('Invalid path: %s', path));\n      }\n\n      selector.push(value);\n      token = getToken();\n\n      if (!token) {\n        break;\n      }\n      else if (token[1] === '/') {\n        token = getToken();\n      }\n\n      if (!token) {\n        break;\n      }\n    }\n\n    _cache[path] = selector;\n  }\n\n  // Execute slector pattern\n  result = [elem];\n  context = new _SelectorContext(elem);\n\n  for (i = 0, len = selector.length; i < len; i++) {\n    select = selector[i];\n    result = select(context, result);\n  }\n\n  return result || [];\n}\n\nfunction find(element, path) {\n  var resultElements = findall(element, path);\n\n  if (resultElements && resultElements.length > 0) {\n    return resultElements[0];\n  }\n\n  return null;\n}\n\nfunction findtext(element, path, defvalue) {\n  var resultElements = findall(element, path);\n\n  if (resultElements && resultElements.length > 0) {\n    return resultElements[0].text;\n  }\n\n  return defvalue;\n}\n\n\nexports.find = find;\nexports.findall = findall;\nexports.findtext = findtext;\n"]},"metadata":{},"sourceType":"module"}