{"ast":null,"code":"var _classCallCheck = require(\"/Users/Cooper/Bluxury_Catering/bluxury-catering copy 3/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/classCallCheck\");\n\nvar _createClass = require(\"/Users/Cooper/Bluxury_Catering/bluxury-catering copy 3/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/createClass\");\n\n/**\r\n * Created by ying.wu on 2017/6/21.\r\n */\nvar helper = require('./helper.js');\n\nvar verify = require('./verification.js');\n\nvar ECpayError = require('./error.js');\n\nvar crypto = require('crypto');\n\nvar url = require('url');\n\nvar querystring = require('querystring');\n\nvar http = require('http');\n\nvar https = require('https');\n\nvar ECpayPaymentClient = /*#__PURE__*/function () {\n  \"use strict\";\n\n  function ECpayPaymentClient() {\n    _classCallCheck(this, ECpayPaymentClient);\n\n    this.helper = new helper();\n    this.verify_aiochkout = new verify.AioCheckOutParamVerify();\n  }\n\n  _createClass(ECpayPaymentClient, [{\n    key: \"aio_check_out_all\",\n    value: function aio_check_out_all(parameters) {\n      var invoice = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var unsupport = [];\n\n      this._aiochkout_base_proc(parameters, invoice, unsupport, 'ALL'); // handle Ignore Payment\n\n\n      parameters['IgnorePayment'] = this.helper.get_ignore_pay().join('#');\n\n      var html = this._aiochkout_pos_proc(parameters);\n\n      return html;\n    }\n  }, {\n    key: \"aio_check_out_credit_onetime\",\n    value: function aio_check_out_credit_onetime(parameters) {\n      var invoice = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var unsupport = [];\n\n      this._aiochkout_base_proc(parameters, invoice, unsupport, 'Credit');\n\n      var html = this._aiochkout_pos_proc(parameters);\n\n      return html;\n    }\n  }, {\n    key: \"aio_check_out_credit_divide\",\n    value: function aio_check_out_credit_divide(parameters) {\n      var invoice = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var installment = arguments.length > 2 ? arguments[2] : undefined;\n      var amount = arguments.length > 3 ? arguments[3] : undefined;\n      var unsupport = ['HoldTradeAMT', 'IgnorePayment', 'Redeem', 'PeriodAmount', 'PeriodType', 'Frequency', 'ExecTimes', 'PeriodReturnURL'];\n\n      this._aiochkout_base_proc(parameters, invoice, unsupport, 'Credit');\n\n      parameters['CreditInstallment'] = installment;\n\n      if (parseInt(parameters['TotalAmount']) !== parseInt(amount)) {\n        parameters['InstallmentAmount'] = amount;\n      }\n\n      var html = this._aiochkout_pos_proc(parameters);\n\n      return html;\n    }\n  }, {\n    key: \"aio_check_out_credit_period\",\n    value: function aio_check_out_credit_period(period_info, parameters) {\n      var invoice = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      // 'PeriodAmount', 'PeriodType', 'Frequency', 'ExecTimes', 'PeriodReturnURL'\n      var unsupport = ['HoldTradeAMT', 'IgnorePayment', 'Redeem', 'CreditInstallment', 'InstallmentAmount'];\n\n      this._aiochkout_base_proc(parameters, invoice, unsupport, 'Credit');\n\n      if (period_info.constructor === Object) {\n        var period_args = ['PeriodAmount', 'PeriodType', 'Frequency', 'ExecTimes', 'PeriodReturnURL'];\n        period_args.sort().forEach(function (pname) {\n          if (Object.keys(period_info).sort().indexOf(pname, 0) === -1) {\n            throw new Error(\"Credit card period parameters must be \".concat(period_args, \".\"));\n          }\n        });\n        Object.assign(parameters, period_info); // Add total amount protection!!!\n\n        var html = this._aiochkout_pos_proc(parameters);\n\n        return html;\n      } else {\n        throw new Error(\"Received period_info argument must be a Object.\");\n      }\n    }\n  }, {\n    key: \"aio_check_out_atm\",\n    value: function aio_check_out_atm(parameters) {\n      var url_return_payinfo = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';\n      var exp_period = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '';\n      var client_redirect = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '';\n      var invoice = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {};\n      var unsupport = ['IgnorePayment'];\n\n      this._aiochkout_base_proc(parameters, invoice, unsupport, 'ATM');\n\n      if (exp_period === '') {\n        delete parameters['ExpireDate'];\n      } else {\n        parameters['ExpireDate'] = exp_period;\n      }\n\n      if (client_redirect === '') {\n        delete parameters['ClientRedirectURL'];\n      } else {\n        parameters['ClientRedirectURL'] = client_redirect;\n      }\n\n      if (url_return_payinfo === '') {\n        delete parameters['PaymentInfoURL'];\n      } else {\n        parameters['PaymentInfoURL'] = url_return_payinfo;\n      }\n\n      var html = this._aiochkout_pos_proc(parameters);\n\n      return html;\n    }\n  }, {\n    key: \"aio_check_out_webatm\",\n    value: function aio_check_out_webatm(parameters) {\n      var invoice = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n      var unsupport = ['IgnorePayment'];\n\n      this._aiochkout_base_proc(parameters, invoice, unsupport, 'WebATM');\n\n      var html = this._aiochkout_pos_proc(parameters);\n\n      return html;\n    }\n  }, {\n    key: \"aio_check_out_cvs\",\n    value: function aio_check_out_cvs(cvs_info, parameters) {\n      var invoice = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var client_redirect_url = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '';\n      var unsupport = ['IgnorePayment'];\n\n      this._aiochkout_base_proc(parameters, invoice, unsupport, 'CVS');\n\n      if (cvs_info.constructor === Object) {\n        var cvs_args = ['StoreExpireDate', 'Desc_1', 'Desc_2', 'Desc_3', 'Desc_4', 'PaymentInfoURL'];\n        cvs_args.sort().forEach(function (pname) {\n          if (Object.keys(cvs_info).sort().indexOf(pname, 0) === -1) {\n            throw new Error(\"CVS info keys must match \".concat(cvs_args, \".\"));\n          }\n        });\n        Object.assign(parameters, cvs_info);\n\n        if (client_redirect_url === '' || client_redirect_url === null) {\n          delete parameters['ClientRedirectURL'];\n        } else {\n          parameters['ClientRedirectURL'] = client_redirect_url;\n        }\n\n        var html = this._aiochkout_pos_proc(parameters);\n\n        return html;\n      } else {\n        throw new Error(\"Received cvs_info argument must be a Object.\");\n      }\n    }\n  }, {\n    key: \"aio_check_out_barcode\",\n    value: function aio_check_out_barcode(barcode_info, parameters) {\n      var invoice = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};\n      var client_redirect_url = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : '';\n      var unsupport = ['IgnorePayment'];\n\n      this._aiochkout_base_proc(parameters, invoice, unsupport, 'BARCODE');\n\n      if (barcode_info.constructor === Object) {\n        var barcode_args = ['StoreExpireDate', 'Desc_1', 'Desc_2', 'Desc_3', 'Desc_4', 'PaymentInfoURL'];\n        barcode_args.sort().forEach(function (pname) {\n          if (Object.keys(barcode_info).sort().indexOf(pname, 0) === -1) {\n            throw new Error(\"BARCODE info keys must match \".concat(barcode_args, \".\"));\n          }\n        });\n        Object.assign(parameters, barcode_info);\n\n        if (client_redirect_url === '' || client_redirect_url === null) {\n          delete parameters['ClientRedirectURL'];\n        } else {\n          parameters['ClientRedirectURL'] = client_redirect_url;\n        }\n\n        var html = this._aiochkout_pos_proc(parameters);\n\n        return html;\n      } else {\n        throw new Error(\"Received cvs_info argument must be a Object.\");\n      }\n    }\n  }, {\n    key: \"_aiochkout_base_proc\",\n    value: function _aiochkout_base_proc(params, inv, unsupport_param, pay_method) {\n      if (params.constructor === Object) {\n        // Remove HoldTradeAMT, IgnorePayment\n        if (unsupport_param.constructor === Array) {\n          unsupport_param.forEach(function (pa) {\n            delete params[pa];\n          });\n        } else {\n          throw new Error(\"argument unsupport_param must be an Array.\");\n        } // User doesn't have to specify ChoosePayment\n\n\n        params['ChoosePayment'] = pay_method; // Process PlatformID & MerchantID by contractor setting\n\n        if (this.helper.is_contractor()) {\n          params['PlatformID'] = this.helper.get_mercid();\n\n          if (params['MerchantID'] === null) {\n            throw new Error(\"[MerchantID] should be specified when you're contractor-Platform.\");\n          }\n        } else {\n          params['PlatformID'] = '';\n          params['MerchantID'] = this.helper.get_mercid();\n        } // InvoiceMark based on keyword argument: invoice\n\n\n        if (inv.constructor === Object && Object.keys(inv).length === 0) {\n          params['InvoiceMark'] = 'N';\n        } else {\n          params['InvoiceMark'] = 'Y';\n          this.verify_aiochkout.verify_aio_inv_param(inv); // this.verify_aiochkout.AioCheckOutParamVerify().verify_aio_inv_param(inv);\n          // merge param & inv param\n\n          Object.assign(params, inv);\n        }\n      } else {\n        throw new ECpayError.ECpayInvalidParam(\"Received parameter object must be a Object.\");\n      }\n    }\n  }, {\n    key: \"_aiochkout_pos_proc\",\n    value: function _aiochkout_pos_proc(params) {\n      this.verify_aiochkout.verify_aio_payment_param(params); // encode special param\n\n      var sp_param = this.verify_aiochkout.get_special_encode_param('AioCheckOut');\n      this.helper.encode_special_param(params, sp_param); // Insert chkmacval\n      // console.log(params);\n\n      var chkmac = this.helper.gen_chk_mac_value(params);\n      params['CheckMacValue'] = chkmac; // gen post html\n\n      var api_url = this.verify_aiochkout.get_svc_url('AioCheckOut', this.helper.get_op_mode());\n      var htm = this.helper.gen_html_post_form(api_url, '_form_aiochk', params); //return post htm\n\n      return htm;\n    }\n  }]);\n\n  return ECpayPaymentClient;\n}();\n\nmodule.exports = ECpayPaymentClient;","map":{"version":3,"sources":["/Users/Cooper/Bluxury_Catering/bluxury-catering copy 3/node_modules/ecpay-payment/lib/ecpay_payment/payment_client.js"],"names":["helper","require","verify","ECpayError","crypto","url","querystring","http","https","ECpayPaymentClient","verify_aiochkout","AioCheckOutParamVerify","parameters","invoice","unsupport","_aiochkout_base_proc","get_ignore_pay","join","html","_aiochkout_pos_proc","installment","amount","parseInt","period_info","constructor","Object","period_args","sort","forEach","pname","keys","indexOf","Error","assign","url_return_payinfo","exp_period","client_redirect","cvs_info","client_redirect_url","cvs_args","barcode_info","barcode_args","params","inv","unsupport_param","pay_method","Array","pa","is_contractor","get_mercid","length","verify_aio_inv_param","ECpayInvalidParam","verify_aio_payment_param","sp_param","get_special_encode_param","encode_special_param","chkmac","gen_chk_mac_value","api_url","get_svc_url","get_op_mode","htm","gen_html_post_form","module","exports"],"mappings":";;;;AAAA;;;AAGA,IAAMA,MAAM,GAAGC,OAAO,CAAC,aAAD,CAAtB;;AACA,IAAMC,MAAM,GAAGD,OAAO,CAAC,mBAAD,CAAtB;;AACA,IAAME,UAAU,GAAGF,OAAO,CAAC,YAAD,CAA1B;;AACA,IAAMG,MAAM,GAAGH,OAAO,CAAC,QAAD,CAAtB;;AACA,IAAMI,GAAG,GAAGJ,OAAO,CAAC,KAAD,CAAnB;;AACA,IAAMK,WAAW,GAAGL,OAAO,CAAC,aAAD,CAA3B;;AACA,IAAMM,IAAI,GAAGN,OAAO,CAAC,MAAD,CAApB;;AACA,IAAMO,KAAK,GAAGP,OAAO,CAAC,OAAD,CAArB;;IAEMQ,kB;;;AACF,gCAAa;AAAA;;AACT,SAAKT,MAAL,GAAc,IAAIA,MAAJ,EAAd;AACA,SAAKU,gBAAL,GAAwB,IAAIR,MAAM,CAACS,sBAAX,EAAxB;AACH;;;;sCAEiBC,U,EAAuB;AAAA,UAAXC,OAAW,uEAAH,EAAG;AACrC,UAAIC,SAAS,GAAG,EAAhB;;AACA,WAAKC,oBAAL,CAA0BH,UAA1B,EAAsCC,OAAtC,EAA+CC,SAA/C,EAA0D,KAA1D,EAFqC,CAGrC;;;AACAF,MAAAA,UAAU,CAAC,eAAD,CAAV,GAA8B,KAAKZ,MAAL,CAAYgB,cAAZ,GAA6BC,IAA7B,CAAkC,GAAlC,CAA9B;;AACA,UAAIC,IAAI,GAAG,KAAKC,mBAAL,CAAyBP,UAAzB,CAAX;;AACA,aAAOM,IAAP;AACH;;;iDAE4BN,U,EAAuB;AAAA,UAAXC,OAAW,uEAAH,EAAG;AAChD,UAAIC,SAAS,GAAG,EAAhB;;AACA,WAAKC,oBAAL,CAA0BH,UAA1B,EAAsCC,OAAtC,EAA+CC,SAA/C,EAA0D,QAA1D;;AACA,UAAII,IAAI,GAAG,KAAKC,mBAAL,CAAyBP,UAAzB,CAAX;;AACA,aAAOM,IAAP;AACH;;;gDAE2BN,U,EAA4C;AAAA,UAAhCC,OAAgC,uEAAxB,EAAwB;AAAA,UAApBO,WAAoB;AAAA,UAAPC,MAAO;AACpE,UAAIP,SAAS,GAAG,CAAC,cAAD,EAAiB,eAAjB,EAAkC,QAAlC,EAA4C,cAA5C,EAA4D,YAA5D,EAA0E,WAA1E,EAAuF,WAAvF,EAAoG,iBAApG,CAAhB;;AACA,WAAKC,oBAAL,CAA0BH,UAA1B,EAAsCC,OAAtC,EAA+CC,SAA/C,EAA0D,QAA1D;;AACAF,MAAAA,UAAU,CAAC,mBAAD,CAAV,GAAkCQ,WAAlC;;AACA,UAAIE,QAAQ,CAACV,UAAU,CAAC,aAAD,CAAX,CAAR,KAAwCU,QAAQ,CAACD,MAAD,CAApD,EAA6D;AACzDT,QAAAA,UAAU,CAAC,mBAAD,CAAV,GAAkCS,MAAlC;AACH;;AACD,UAAIH,IAAI,GAAG,KAAKC,mBAAL,CAAyBP,UAAzB,CAAX;;AACA,aAAOM,IAAP;AACH;;;gDAE2BK,W,EAAaX,U,EAAuB;AAAA,UAAXC,OAAW,uEAAH,EAAG;AAC5D;AACA,UAAIC,SAAS,GAAG,CAAC,cAAD,EAAiB,eAAjB,EAAkC,QAAlC,EAA4C,mBAA5C,EAAiE,mBAAjE,CAAhB;;AACA,WAAKC,oBAAL,CAA0BH,UAA1B,EAAsCC,OAAtC,EAA+CC,SAA/C,EAA0D,QAA1D;;AACA,UAAIS,WAAW,CAACC,WAAZ,KAA4BC,MAAhC,EAAuC;AACnC,YAAIC,WAAW,GAAG,CAAC,cAAD,EAAiB,YAAjB,EAA+B,WAA/B,EAA4C,WAA5C,EAAyD,iBAAzD,CAAlB;AACAA,QAAAA,WAAW,CAACC,IAAZ,GAAmBC,OAAnB,CAA2B,UAAUC,KAAV,EAAiB;AACxC,cAAIJ,MAAM,CAACK,IAAP,CAAYP,WAAZ,EAAyBI,IAAzB,GAAgCI,OAAhC,CAAwCF,KAAxC,EAA+C,CAA/C,MAAsD,CAAC,CAA3D,EAA6D;AACzD,kBAAM,IAAIG,KAAJ,iDAAmDN,WAAnD,OAAN;AACH;AACJ,SAJD;AAKAD,QAAAA,MAAM,CAACQ,MAAP,CAAcrB,UAAd,EAA0BW,WAA1B,EAPmC,CAQ/B;;AAEJ,YAAIL,IAAI,GAAG,KAAKC,mBAAL,CAAyBP,UAAzB,CAAX;;AACA,eAAOM,IAAP;AACH,OAZD,MAYO;AACH,cAAM,IAAIc,KAAJ,mDAAN;AACH;AACJ;;;sCAEiBpB,U,EAAyF;AAAA,UAA7EsB,kBAA6E,uEAAxD,EAAwD;AAAA,UAApDC,UAAoD,uEAAvC,EAAuC;AAAA,UAAnCC,eAAmC,uEAAjB,EAAiB;AAAA,UAAbvB,OAAa,uEAAH,EAAG;AACvG,UAAIC,SAAS,GAAG,CAAC,eAAD,CAAhB;;AACA,WAAKC,oBAAL,CAA0BH,UAA1B,EAAsCC,OAAtC,EAA+CC,SAA/C,EAA0D,KAA1D;;AACA,UAAIqB,UAAU,KAAK,EAAnB,EAAsB;AAClB,eAAOvB,UAAU,CAAC,YAAD,CAAjB;AACH,OAFD,MAEO;AACHA,QAAAA,UAAU,CAAC,YAAD,CAAV,GAA2BuB,UAA3B;AACH;;AACD,UAAIC,eAAe,KAAK,EAAxB,EAA2B;AACvB,eAAOxB,UAAU,CAAC,mBAAD,CAAjB;AACH,OAFD,MAEO;AACHA,QAAAA,UAAU,CAAC,mBAAD,CAAV,GAAkCwB,eAAlC;AACH;;AACD,UAAIF,kBAAkB,KAAK,EAA3B,EAA8B;AAC1B,eAAOtB,UAAU,CAAC,gBAAD,CAAjB;AACH,OAFD,MAEO;AACHA,QAAAA,UAAU,CAAC,gBAAD,CAAV,GAA+BsB,kBAA/B;AACH;;AACD,UAAIhB,IAAI,GAAG,KAAKC,mBAAL,CAAyBP,UAAzB,CAAX;;AACA,aAAOM,IAAP;AACH;;;yCAEoBN,U,EAAyB;AAAA,UAAbC,OAAa,uEAAH,EAAG;AAC1C,UAAIC,SAAS,GAAG,CAAC,eAAD,CAAhB;;AACA,WAAKC,oBAAL,CAA0BH,UAA1B,EAAsCC,OAAtC,EAA+CC,SAA/C,EAA0D,QAA1D;;AACA,UAAII,IAAI,GAAG,KAAKC,mBAAL,CAAyBP,UAAzB,CAAX;;AACA,aAAOM,IAAP;AACH;;;sCAEiBmB,Q,EAAUzB,U,EAAmD;AAAA,UAAvCC,OAAuC,uEAA7B,EAA6B;AAAA,UAAzByB,mBAAyB,uEAAH,EAAG;AAC3E,UAAIxB,SAAS,GAAG,CAAC,eAAD,CAAhB;;AACA,WAAKC,oBAAL,CAA0BH,UAA1B,EAAsCC,OAAtC,EAA+CC,SAA/C,EAA0D,KAA1D;;AACA,UAAIuB,QAAQ,CAACb,WAAT,KAAyBC,MAA7B,EAAoC;AAChC,YAAIc,QAAQ,GAAG,CAAC,iBAAD,EAAoB,QAApB,EAA8B,QAA9B,EAAwC,QAAxC,EAAkD,QAAlD,EAA4D,gBAA5D,CAAf;AACAA,QAAAA,QAAQ,CAACZ,IAAT,GAAgBC,OAAhB,CAAwB,UAAUC,KAAV,EAAiB;AACrC,cAAIJ,MAAM,CAACK,IAAP,CAAYO,QAAZ,EAAsBV,IAAtB,GAA6BI,OAA7B,CAAqCF,KAArC,EAA4C,CAA5C,MAAmD,CAAC,CAAxD,EAA0D;AACtD,kBAAM,IAAIG,KAAJ,oCAAsCO,QAAtC,OAAN;AACH;AACJ,SAJD;AAMAd,QAAAA,MAAM,CAACQ,MAAP,CAAcrB,UAAd,EAA0ByB,QAA1B;;AACA,YAAIC,mBAAmB,KAAK,EAAxB,IAA8BA,mBAAmB,KAAK,IAA1D,EAA+D;AAC3D,iBAAO1B,UAAU,CAAC,mBAAD,CAAjB;AACH,SAFD,MAEO;AACHA,UAAAA,UAAU,CAAC,mBAAD,CAAV,GAAkC0B,mBAAlC;AACH;;AACD,YAAIpB,IAAI,GAAG,KAAKC,mBAAL,CAAyBP,UAAzB,CAAX;;AACA,eAAOM,IAAP;AACH,OAhBD,MAgBO;AACH,cAAM,IAAIc,KAAJ,gDAAN;AACH;AACJ;;;0CAEqBQ,Y,EAAc5B,U,EAAmD;AAAA,UAAvCC,OAAuC,uEAA7B,EAA6B;AAAA,UAAzByB,mBAAyB,uEAAH,EAAG;AACnF,UAAIxB,SAAS,GAAG,CAAC,eAAD,CAAhB;;AACA,WAAKC,oBAAL,CAA0BH,UAA1B,EAAsCC,OAAtC,EAA+CC,SAA/C,EAA0D,SAA1D;;AACA,UAAI0B,YAAY,CAAChB,WAAb,KAA6BC,MAAjC,EAAwC;AACpC,YAAIgB,YAAY,GAAG,CAAC,iBAAD,EAAoB,QAApB,EAA8B,QAA9B,EAAwC,QAAxC,EAAkD,QAAlD,EAA4D,gBAA5D,CAAnB;AACAA,QAAAA,YAAY,CAACd,IAAb,GAAoBC,OAApB,CAA4B,UAAUC,KAAV,EAAiB;AACzC,cAAIJ,MAAM,CAACK,IAAP,CAAYU,YAAZ,EAA0Bb,IAA1B,GAAiCI,OAAjC,CAAyCF,KAAzC,EAAgD,CAAhD,MAAuD,CAAC,CAA5D,EAA8D;AAC1D,kBAAM,IAAIG,KAAJ,wCAA0CS,YAA1C,OAAN;AACH;AACJ,SAJD;AAKAhB,QAAAA,MAAM,CAACQ,MAAP,CAAcrB,UAAd,EAA0B4B,YAA1B;;AACA,YAAIF,mBAAmB,KAAK,EAAxB,IAA8BA,mBAAmB,KAAK,IAA1D,EAA+D;AAC3D,iBAAO1B,UAAU,CAAC,mBAAD,CAAjB;AACH,SAFD,MAEO;AACHA,UAAAA,UAAU,CAAC,mBAAD,CAAV,GAAkC0B,mBAAlC;AACH;;AACD,YAAIpB,IAAI,GAAG,KAAKC,mBAAL,CAAyBP,UAAzB,CAAX;;AACA,eAAOM,IAAP;AACH,OAfD,MAeO;AACH,cAAM,IAAIc,KAAJ,gDAAN;AACH;AACJ;;;yCAEoBU,M,EAAQC,G,EAAKC,e,EAAiBC,U,EAAW;AAC1D,UAAIH,MAAM,CAAClB,WAAP,KAAuBC,MAA3B,EAAkC;AAC9B;AACA,YAAImB,eAAe,CAACpB,WAAhB,KAAgCsB,KAApC,EAA0C;AACtCF,UAAAA,eAAe,CAAChB,OAAhB,CAAwB,UAAUmB,EAAV,EAAc;AACnC,mBAAOL,MAAM,CAACK,EAAD,CAAb;AACF,WAFD;AAGH,SAJD,MAIO;AACH,gBAAM,IAAIf,KAAJ,8CAAN;AACH,SAR6B,CAS9B;;;AACAU,QAAAA,MAAM,CAAC,eAAD,CAAN,GAA0BG,UAA1B,CAV8B,CAW9B;;AACA,YAAI,KAAK7C,MAAL,CAAYgD,aAAZ,EAAJ,EAAgC;AAC5BN,UAAAA,MAAM,CAAC,YAAD,CAAN,GAAuB,KAAK1C,MAAL,CAAYiD,UAAZ,EAAvB;;AACA,cAAIP,MAAM,CAAC,YAAD,CAAN,KAAyB,IAA7B,EAAkC;AAC9B,kBAAM,IAAIV,KAAJ,qEAAN;AACH;AACJ,SALD,MAKO;AACHU,UAAAA,MAAM,CAAC,YAAD,CAAN,GAAuB,EAAvB;AACAA,UAAAA,MAAM,CAAC,YAAD,CAAN,GAAuB,KAAK1C,MAAL,CAAYiD,UAAZ,EAAvB;AACH,SApB6B,CAqB9B;;;AACA,YAAIN,GAAG,CAACnB,WAAJ,KAAoBC,MAApB,IAA8BA,MAAM,CAACK,IAAP,CAAYa,GAAZ,EAAiBO,MAAjB,KAA4B,CAA9D,EAAgE;AAC5DR,UAAAA,MAAM,CAAC,aAAD,CAAN,GAAwB,GAAxB;AACH,SAFD,MAEO;AACHA,UAAAA,MAAM,CAAC,aAAD,CAAN,GAAwB,GAAxB;AACA,eAAKhC,gBAAL,CAAsByC,oBAAtB,CAA2CR,GAA3C,EAFG,CAGH;AACA;;AACAlB,UAAAA,MAAM,CAACQ,MAAP,CAAcS,MAAd,EAAsBC,GAAtB;AACH;AACJ,OA/BD,MA+BO;AACH,cAAM,IAAIxC,UAAU,CAACiD,iBAAf,+CAAN;AACH;AACJ;;;wCAEmBV,M,EAAO;AACvB,WAAKhC,gBAAL,CAAsB2C,wBAAtB,CAA+CX,MAA/C,EADuB,CAEvB;;AACA,UAAIY,QAAQ,GAAG,KAAK5C,gBAAL,CAAsB6C,wBAAtB,CAA+C,aAA/C,CAAf;AACA,WAAKvD,MAAL,CAAYwD,oBAAZ,CAAiCd,MAAjC,EAAyCY,QAAzC,EAJuB,CAMvB;AACA;;AACA,UAAIG,MAAM,GAAG,KAAKzD,MAAL,CAAY0D,iBAAZ,CAA8BhB,MAA9B,CAAb;AACAA,MAAAA,MAAM,CAAC,eAAD,CAAN,GAA0Be,MAA1B,CATuB,CAUvB;;AACA,UAAIE,OAAO,GAAG,KAAKjD,gBAAL,CAAsBkD,WAAtB,CAAkC,aAAlC,EAAiD,KAAK5D,MAAL,CAAY6D,WAAZ,EAAjD,CAAd;AACA,UAAIC,GAAG,GAAG,KAAK9D,MAAL,CAAY+D,kBAAZ,CAA+BJ,OAA/B,EAAwC,cAAxC,EAAwDjB,MAAxD,CAAV,CAZuB,CAavB;;AACA,aAAOoB,GAAP;AACH;;;;;;AAELE,MAAM,CAACC,OAAP,GAAiBxD,kBAAjB","sourcesContent":["/**\r\n * Created by ying.wu on 2017/6/21.\r\n */\r\nconst helper = require('./helper.js');\r\nconst verify = require('./verification.js');\r\nconst ECpayError = require('./error.js');\r\nconst crypto = require('crypto');\r\nconst url = require('url');\r\nconst querystring = require('querystring');\r\nconst http = require('http');\r\nconst https = require('https');\r\n\r\nclass ECpayPaymentClient{\r\n    constructor(){\r\n        this.helper = new helper();\r\n        this.verify_aiochkout = new verify.AioCheckOutParamVerify();\r\n    }\r\n\r\n    aio_check_out_all(parameters, invoice={}){\r\n        let unsupport = [];\r\n        this._aiochkout_base_proc(parameters, invoice, unsupport, 'ALL');\r\n        // handle Ignore Payment\r\n        parameters['IgnorePayment'] = this.helper.get_ignore_pay().join('#');\r\n        let html = this._aiochkout_pos_proc(parameters);\r\n        return html;\r\n    }\r\n\r\n    aio_check_out_credit_onetime(parameters, invoice={}){\r\n        let unsupport = [];\r\n        this._aiochkout_base_proc(parameters, invoice, unsupport, 'Credit');\r\n        let html = this._aiochkout_pos_proc(parameters);\r\n        return html;\r\n    }\r\n\r\n    aio_check_out_credit_divide(parameters, invoice={}, installment, amount){\r\n        let unsupport = ['HoldTradeAMT', 'IgnorePayment', 'Redeem', 'PeriodAmount', 'PeriodType', 'Frequency', 'ExecTimes', 'PeriodReturnURL'];\r\n        this._aiochkout_base_proc(parameters, invoice, unsupport, 'Credit');\r\n        parameters['CreditInstallment'] = installment;\r\n        if (parseInt(parameters['TotalAmount']) !== parseInt(amount)){\r\n            parameters['InstallmentAmount'] = amount;\r\n        }\r\n        let html = this._aiochkout_pos_proc(parameters);\r\n        return html;\r\n    }\r\n\r\n    aio_check_out_credit_period(period_info, parameters, invoice={}){\r\n        // 'PeriodAmount', 'PeriodType', 'Frequency', 'ExecTimes', 'PeriodReturnURL'\r\n        let unsupport = ['HoldTradeAMT', 'IgnorePayment', 'Redeem', 'CreditInstallment', 'InstallmentAmount'];\r\n        this._aiochkout_base_proc(parameters, invoice, unsupport, 'Credit');\r\n        if (period_info.constructor === Object){\r\n            let period_args = ['PeriodAmount', 'PeriodType', 'Frequency', 'ExecTimes', 'PeriodReturnURL'];\r\n            period_args.sort().forEach(function (pname) {\r\n                if (Object.keys(period_info).sort().indexOf(pname, 0) === -1){\r\n                    throw new Error(`Credit card period parameters must be ${period_args}.`);\r\n                }\r\n            });\r\n            Object.assign(parameters, period_info);\r\n                // Add total amount protection!!!\r\n\r\n            let html = this._aiochkout_pos_proc(parameters);\r\n            return html;\r\n        } else {\r\n            throw new Error(`Received period_info argument must be a Object.`);\r\n        }\r\n    }\r\n\r\n    aio_check_out_atm(parameters, url_return_payinfo = '', exp_period = '', client_redirect = '', invoice = {}){\r\n        let unsupport = ['IgnorePayment'];\r\n        this._aiochkout_base_proc(parameters, invoice, unsupport, 'ATM');\r\n        if (exp_period === ''){\r\n            delete parameters['ExpireDate'];\r\n        } else {\r\n            parameters['ExpireDate'] = exp_period;\r\n        }\r\n        if (client_redirect === ''){\r\n            delete parameters['ClientRedirectURL'];\r\n        } else {\r\n            parameters['ClientRedirectURL'] = client_redirect;\r\n        }\r\n        if (url_return_payinfo === ''){\r\n            delete parameters['PaymentInfoURL'];\r\n        } else {\r\n            parameters['PaymentInfoURL'] = url_return_payinfo;\r\n        }\r\n        let html = this._aiochkout_pos_proc(parameters);\r\n        return html;\r\n    }\r\n\r\n    aio_check_out_webatm(parameters, invoice = {}){\r\n        let unsupport = ['IgnorePayment'];\r\n        this._aiochkout_base_proc(parameters, invoice, unsupport, 'WebATM');\r\n        let html = this._aiochkout_pos_proc(parameters);\r\n        return html;\r\n    }\r\n\r\n    aio_check_out_cvs(cvs_info, parameters, invoice = {}, client_redirect_url = ''){\r\n        let unsupport = ['IgnorePayment'];\r\n        this._aiochkout_base_proc(parameters, invoice, unsupport, 'CVS');\r\n        if (cvs_info.constructor === Object){\r\n            let cvs_args = ['StoreExpireDate', 'Desc_1', 'Desc_2', 'Desc_3', 'Desc_4', 'PaymentInfoURL'];\r\n            cvs_args.sort().forEach(function (pname) {\r\n                if (Object.keys(cvs_info).sort().indexOf(pname, 0) === -1){\r\n                    throw new Error(`CVS info keys must match ${cvs_args}.`);\r\n                }\r\n            });\r\n\r\n            Object.assign(parameters, cvs_info);\r\n            if (client_redirect_url === '' || client_redirect_url === null){\r\n                delete parameters['ClientRedirectURL'];\r\n            } else {\r\n                parameters['ClientRedirectURL'] = client_redirect_url;\r\n            }\r\n            let html = this._aiochkout_pos_proc(parameters);\r\n            return html;\r\n        } else {\r\n            throw new Error(`Received cvs_info argument must be a Object.`);\r\n        }\r\n    }\r\n\r\n    aio_check_out_barcode(barcode_info, parameters, invoice = {}, client_redirect_url = ''){\r\n        let unsupport = ['IgnorePayment'];\r\n        this._aiochkout_base_proc(parameters, invoice, unsupport, 'BARCODE');\r\n        if (barcode_info.constructor === Object){\r\n            let barcode_args = ['StoreExpireDate', 'Desc_1', 'Desc_2', 'Desc_3', 'Desc_4', 'PaymentInfoURL'];\r\n            barcode_args.sort().forEach(function (pname) {\r\n                if (Object.keys(barcode_info).sort().indexOf(pname, 0) === -1){\r\n                    throw new Error(`BARCODE info keys must match ${barcode_args}.`);\r\n                }\r\n            });\r\n            Object.assign(parameters, barcode_info);\r\n            if (client_redirect_url === '' || client_redirect_url === null){\r\n                delete parameters['ClientRedirectURL'];\r\n            } else {\r\n                parameters['ClientRedirectURL'] = client_redirect_url;\r\n            }\r\n            let html = this._aiochkout_pos_proc(parameters);\r\n            return html;\r\n        } else {\r\n            throw new Error(`Received cvs_info argument must be a Object.`);\r\n        }\r\n    }\r\n\r\n    _aiochkout_base_proc(params, inv, unsupport_param, pay_method){\r\n        if (params.constructor === Object){\r\n            // Remove HoldTradeAMT, IgnorePayment\r\n            if (unsupport_param.constructor === Array){\r\n                unsupport_param.forEach(function (pa) {\r\n                   delete params[pa];\r\n                });\r\n            } else {\r\n                throw new Error(`argument unsupport_param must be an Array.`);\r\n            }\r\n            // User doesn't have to specify ChoosePayment\r\n            params['ChoosePayment'] = pay_method;\r\n            // Process PlatformID & MerchantID by contractor setting\r\n            if (this.helper.is_contractor()){\r\n                params['PlatformID'] = this.helper.get_mercid();\r\n                if (params['MerchantID'] === null){\r\n                    throw new Error(`[MerchantID] should be specified when you're contractor-Platform.`);\r\n                }\r\n            } else {\r\n                params['PlatformID'] = '';\r\n                params['MerchantID'] = this.helper.get_mercid();\r\n            }\r\n            // InvoiceMark based on keyword argument: invoice\r\n            if (inv.constructor === Object && Object.keys(inv).length === 0){\r\n                params['InvoiceMark'] = 'N';\r\n            } else {\r\n                params['InvoiceMark'] = 'Y';\r\n                this.verify_aiochkout.verify_aio_inv_param(inv);\r\n                // this.verify_aiochkout.AioCheckOutParamVerify().verify_aio_inv_param(inv);\r\n                // merge param & inv param\r\n                Object.assign(params, inv);\r\n            }\r\n        } else {\r\n            throw new ECpayError.ECpayInvalidParam(`Received parameter object must be a Object.`);\r\n        }\r\n    }\r\n\r\n    _aiochkout_pos_proc(params){\r\n        this.verify_aiochkout.verify_aio_payment_param(params);\r\n        // encode special param\r\n        let sp_param = this.verify_aiochkout.get_special_encode_param('AioCheckOut');\r\n        this.helper.encode_special_param(params, sp_param);\r\n\r\n        // Insert chkmacval\r\n        // console.log(params);\r\n        let chkmac = this.helper.gen_chk_mac_value(params);\r\n        params['CheckMacValue'] = chkmac;\r\n        // gen post html\r\n        let api_url = this.verify_aiochkout.get_svc_url('AioCheckOut', this.helper.get_op_mode());\r\n        let htm = this.helper.gen_html_post_form(api_url, '_form_aiochk', params);\r\n        //return post htm\r\n        return htm;\r\n    }\r\n}\r\nmodule.exports = ECpayPaymentClient;"]},"metadata":{},"sourceType":"script"}