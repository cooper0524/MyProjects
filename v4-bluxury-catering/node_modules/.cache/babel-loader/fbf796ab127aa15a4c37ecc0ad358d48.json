{"ast":null,"code":"var _jsxFileName = \"/Users/Cooper/Bluxury_Catering/bluxury-catering copy 3/src/components/EditForm.jsx\";\nimport React, { useState } from \"react\";\nimport CustomField from \"../common/CustomField\";\nimport { Formik, Form, Field, ErrorMessage } from \"formik\";\nimport BootForm from \"react-bootstrap/Form\";\nimport { Button } from \"react-bootstrap\";\nimport * as Yup from \"yup\";\nimport firebase, { storage } from \"../services/firebase\";\n\nconst EditForm = ({\n  categories,\n  product,\n  onCloseModal,\n  doc,\n  collection,\n  src\n}) => {\n  const [image, setImage] = useState(null);\n  const [url, setUrl] = useState(product.url);\n  const [progress, setProgress] = useState(0);\n  const [title, setTitle] = useState(product.title);\n  const [category, setCategory] = useState(product.category);\n  const [price, setPrice] = useState(product.price);\n  const [xPrice, setXPrice] = useState(product.xPrice);\n  const [desc, setDesc] = useState(product.desc);\n  const productId = product.id;\n  var randomNum = 1 + Math.random() * (1000 - 1);\n\n  const handleImgDisplay = event => {\n    setImage(event.target.files[0]);\n  };\n\n  const handleUpload = e => {\n    e.preventDefault();\n    const imgRef = image.name + randomNum;\n    const uploadTask = storage.ref(imgRef).put(image);\n    uploadTask.on(\"state_changed\", snapshot => {\n      const progress = Math.round(snapshot.bytesTransferred / snapshot.totalBytes * 100);\n      setProgress(progress);\n    }, error => {\n      console.log(error);\n    }, () => {\n      storage.ref(\"images\").child(image.name).getDownloadURL().then(url => {\n        if (!url) {\n          setUrl(src);\n        }\n\n        setUrl(url);\n      });\n    });\n  };\n\n  const handleSubmit = () => {\n    if (title.trim() === \"\") {\n      alert(\"?\");\n    } else {\n      var editTime = Date();\n      editTime = firebase.firestore.Timestamp.fromDate(new Date()).toDate();\n      firebase.firestore().collection(\"products\").doc(doc).collection(collection).doc(productId).set({\n        title,\n        category,\n        price,\n        xPrice,\n        url,\n        editTime,\n        desc\n      }).then(onCloseModal);\n    }\n  };\n\n  const validationSchema = Yup.object().shape({\n    title: Yup.string().required(\"First Name is required\"),\n    category: Yup.string().required(),\n    price: Yup.string().required(\"Password is required\"),\n    xPrice: Yup.string(),\n    desc: Yup.string()\n  });\n  const initialValues = {\n    title: title,\n    category: category,\n    price: price,\n    xPrice: xPrice,\n    desc: desc\n  };\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"section\", {\n    id: \"productForm\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"progress\", {\n    id: \"progress\",\n    value: progress,\n    max: \"100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 9\n    }\n  }), /*#__PURE__*/React.createElement(BootForm, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 99,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"img\", {\n    className: \"d-flex m-auto\",\n    src: url,\n    alt: \"productImg\",\n    height: \"200px\",\n    width: \"100%\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(BootForm.File, {\n    id: \"exampleFormControlFile1\",\n    label: \"\\u9078\\u53D6\\u5716\\u7247\",\n    onChange: handleImgDisplay,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 11\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex justify-content-center pt-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 11\n    }\n  }, image ? /*#__PURE__*/React.createElement(Button, {\n    variant: \"danger\",\n    type: \"button\",\n    onClick: handleUpload,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 114,\n      columnNumber: 15\n    }\n  }, \"\\u65B0\\u589E\") : /*#__PURE__*/React.createElement(Button, {\n    variant: \"danger\",\n    type: \"button\",\n    onClick: handleUpload,\n    disabled: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 15\n    }\n  }, \"\\u65B0\\u589E\")))), /*#__PURE__*/React.createElement(Formik, {\n    initialValues: initialValues,\n    validationSchema: validationSchema,\n    onSubmit: handleSubmit,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 7\n    }\n  }, ({\n    errors,\n    touched\n  }) => /*#__PURE__*/React.createElement(Form, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(CustomField, {\n    label: \"\\u7522\\u54C1\\u540D\\u7A31\",\n    name: \"title\",\n    errors: errors.title,\n    touched: touched.title,\n    onKeyUp: e => {\n      setTitle(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-group text-left\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    htmlFor: \"category\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 15\n    }\n  }, \"\\u7522\\u54C1\\u985E\\u5225\"), /*#__PURE__*/React.createElement(Field, {\n    as: \"select\",\n    label: \"\\u7522\\u54C1\\u985E\\u5225\",\n    name: \"category\",\n    onBlur: e => {\n      setCategory(e.target.value);\n    },\n    className: \"form-control\" + (errors.category && touched.category ? \" is-invalid\" : \"\"),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 15\n    }\n  }, categories.map(category => /*#__PURE__*/React.createElement(\"option\", {\n    key: category,\n    value: category,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 19\n    }\n  }, category))), /*#__PURE__*/React.createElement(ErrorMessage, {\n    name: \"category\",\n    component: \"div\",\n    className: \"invalid-feedback\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 15\n    }\n  })), /*#__PURE__*/React.createElement(CustomField, {\n    type: \"textarea\",\n    label: \"\\u5B9A\\u50F9\",\n    name: \"price\",\n    errors: errors.price,\n    touched: touched.price,\n    onKeyUp: e => {\n      setPrice(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 175,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(CustomField, {\n    label: \"\\u7279\\u50F9\",\n    name: \"xPrice\",\n    placeholder: \"\\u7121\\u7279\\u50F9\\u8ACB\\u7A7A\\u767D\",\n    errors: errors.xPrice,\n    touched: touched.xPrice,\n    onKeyUp: e => {\n      setXPrice(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(CustomField, {\n    component: \"textarea\",\n    label: \"\\u5546\\u54C1\\u4ECB\\u7D39\",\n    name: \"desc\",\n    errors: errors.desc,\n    touched: touched.desc,\n    onKeyUp: e => {\n      setDesc(e.target.value);\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 13\n    }\n  }), /*#__PURE__*/React.createElement(Button, {\n    variant: \"primary\",\n    type: \"submit\",\n    value: \"Submit\",\n    block: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 13\n    }\n  }, \"\\u65B0\\u589E\")))) // <Form>\n  //   <progress value={progress} max=\"100\" />\n  //   <Form.Group>\n  //     <img\n  //       src={url || \"https://via.placeholder.com/300\"}\n  //       alt=\"productImg\"\n  //       height=\"200px\"\n  //     />\n  //     <Form.File\n  //       id=\"exampleFormControlFile1\"\n  //       label=\"選取圖片\"\n  //       onChange={handleImgDisplay}\n  //     />\n  //     <Button variant=\"danger\" type=\"button\" onClick={handleUpload}>\n  //       新增\n  //     </Button>\n  //   </Form.Group>\n  //   <Form.Group controlId=\"productTitle\">\n  //     <Form.Label>產品名稱</Form.Label>\n  //     <Form.Control\n  //       onChange={(e) => setTitle(e.currentTarget.value)}\n  //       value={title}\n  //     />\n  //   </Form.Group>\n  //   <Form.Group controlId=\"productCategory\">\n  //     <Form.Label>產品類別</Form.Label>\n  //     <Form.Control\n  //       value={category}\n  //       as=\"select\"\n  //       onChange={(e) => setCategory(e.currentTarget.value)}\n  //     >\n  //       {categories.map((category) => (\n  //         <option key={category}>{category}</option>\n  //       ))}\n  //     </Form.Control>\n  //   </Form.Group>\n  //   <Form.Group controlId=\"productPrice\">\n  //     <Form.Label>原價</Form.Label>\n  //     <Form.Control\n  //       value={price}\n  //       type=\"number\"\n  //       onChange={(e) => setPrice(e.currentTarget.value)}\n  //     />\n  //   </Form.Group>\n  //   <Form.Group controlId=\"productXPrice\">\n  //     <Form.Label>特價</Form.Label>\n  //     <Form.Control\n  //       value={xPrice}\n  //       type=\"number\"\n  //       placeholder=\"無特價請空白\"\n  //       onChange={(e) => setXPrice(e.currentTarget.value)}\n  //     />\n  //   </Form.Group>\n  //   <Button variant=\"primary\" type=\"button\" onClick={handleSubmit} block>\n  //     確認變更\n  //   </Button>\n  // </Form>\n  ;\n};\n\nexport default EditForm;","map":{"version":3,"sources":["/Users/Cooper/Bluxury_Catering/bluxury-catering copy 3/src/components/EditForm.jsx"],"names":["React","useState","CustomField","Formik","Form","Field","ErrorMessage","BootForm","Button","Yup","firebase","storage","EditForm","categories","product","onCloseModal","doc","collection","src","image","setImage","url","setUrl","progress","setProgress","title","setTitle","category","setCategory","price","setPrice","xPrice","setXPrice","desc","setDesc","productId","id","randomNum","Math","random","handleImgDisplay","event","target","files","handleUpload","e","preventDefault","imgRef","name","uploadTask","ref","put","on","snapshot","round","bytesTransferred","totalBytes","error","console","log","child","getDownloadURL","then","handleSubmit","trim","alert","editTime","Date","firestore","Timestamp","fromDate","toDate","set","validationSchema","object","shape","string","required","initialValues","errors","touched","value","map"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport CustomField from \"../common/CustomField\";\nimport { Formik, Form, Field, ErrorMessage } from \"formik\";\nimport BootForm from \"react-bootstrap/Form\";\nimport { Button } from \"react-bootstrap\";\nimport * as Yup from \"yup\";\nimport firebase, { storage } from \"../services/firebase\";\n\nconst EditForm = ({\n  categories,\n  product,\n  onCloseModal,\n  doc,\n  collection,\n  src,\n}) => {\n  const [image, setImage] = useState(null);\n  const [url, setUrl] = useState(product.url);\n  const [progress, setProgress] = useState(0);\n  const [title, setTitle] = useState(product.title);\n  const [category, setCategory] = useState(product.category);\n  const [price, setPrice] = useState(product.price);\n  const [xPrice, setXPrice] = useState(product.xPrice);\n  const [desc, setDesc] = useState(product.desc);\n  const productId = product.id;\n\n  var randomNum = 1 + Math.random() * (1000 - 1);\n  const handleImgDisplay = (event) => {\n    setImage(event.target.files[0]);\n  };\n\n  const handleUpload = (e) => {\n    e.preventDefault();\n    const imgRef = image.name + randomNum;\n    const uploadTask = storage.ref(imgRef).put(image);\n    uploadTask.on(\n      \"state_changed\",\n      (snapshot) => {\n        const progress = Math.round(\n          (snapshot.bytesTransferred / snapshot.totalBytes) * 100\n        );\n        setProgress(progress);\n      },\n      (error) => {\n        console.log(error);\n      },\n      () => {\n        storage\n          .ref(\"images\")\n          .child(image.name)\n          .getDownloadURL()\n          .then((url) => {\n            if (!url) {\n              setUrl(src);\n            }\n            setUrl(url);\n          });\n      }\n    );\n  };\n\n  const handleSubmit = () => {\n    if (title.trim() === \"\") {\n      alert(\"?\");\n    } else {\n      var editTime = Date();\n      editTime = firebase.firestore.Timestamp.fromDate(new Date()).toDate();\n      firebase\n        .firestore()\n        .collection(\"products\")\n        .doc(doc)\n        .collection(collection)\n        .doc(productId)\n        .set({ title, category, price, xPrice, url, editTime, desc })\n        .then(onCloseModal);\n    }\n  };\n\n  const validationSchema = Yup.object().shape({\n    title: Yup.string().required(\"First Name is required\"),\n    category: Yup.string().required(),\n    price: Yup.string().required(\"Password is required\"),\n    xPrice: Yup.string(),\n    desc: Yup.string(),\n  });\n\n  const initialValues = {\n    title: title,\n    category: category,\n    price: price,\n    xPrice: xPrice,\n    desc: desc,\n  };\n\n  return (\n    <div>\n      <section id=\"productForm\">\n        <progress id=\"progress\" value={progress} max=\"100\" />\n        <BootForm>\n          <img\n            className=\"d-flex m-auto\"\n            src={url}\n            alt=\"productImg\"\n            height=\"200px\"\n            width=\"100%\"\n          />\n          <BootForm.File\n            id=\"exampleFormControlFile1\"\n            label=\"選取圖片\"\n            onChange={handleImgDisplay}\n          />\n          <div className=\"d-flex justify-content-center pt-2\">\n            {image ? (\n              <Button variant=\"danger\" type=\"button\" onClick={handleUpload}>\n                新增\n              </Button>\n            ) : (\n              <Button\n                variant=\"danger\"\n                type=\"button\"\n                onClick={handleUpload}\n                disabled\n              >\n                新增\n              </Button>\n            )}\n          </div>\n        </BootForm>\n      </section>\n\n      <Formik\n        initialValues={initialValues}\n        validationSchema={validationSchema}\n        onSubmit={handleSubmit}\n      >\n        {({ errors, touched }) => (\n          <Form>\n            <CustomField\n              label=\"產品名稱\"\n              name=\"title\"\n              errors={errors.title}\n              touched={touched.title}\n              onKeyUp={(e) => {\n                setTitle(e.target.value);\n              }}\n            />\n            <div className=\"form-group text-left\">\n              <label htmlFor=\"category\">產品類別</label>\n              <Field\n                as=\"select\"\n                label=\"產品類別\"\n                name=\"category\"\n                onBlur={(e) => {\n                  setCategory(e.target.value);\n                }}\n                className={\n                  \"form-control\" +\n                  (errors.category && touched.category ? \" is-invalid\" : \"\")\n                }\n              >\n                {categories.map((category) => (\n                  <option key={category} value={category}>\n                    {category}\n                  </option>\n                ))}\n              </Field>\n\n              <ErrorMessage\n                name=\"category\"\n                component=\"div\"\n                className=\"invalid-feedback\"\n              />\n            </div>\n\n            <CustomField\n              type=\"textarea\"\n              label=\"定價\"\n              name=\"price\"\n              errors={errors.price}\n              touched={touched.price}\n              onKeyUp={(e) => {\n                setPrice(e.target.value);\n              }}\n            />\n            <CustomField\n              label=\"特價\"\n              name=\"xPrice\"\n              placeholder=\"無特價請空白\"\n              errors={errors.xPrice}\n              touched={touched.xPrice}\n              onKeyUp={(e) => {\n                setXPrice(e.target.value);\n              }}\n            />\n            <CustomField\n              component=\"textarea\"\n              label=\"商品介紹\"\n              name=\"desc\"\n              errors={errors.desc}\n              touched={touched.desc}\n              onKeyUp={(e) => {\n                setDesc(e.target.value);\n              }}\n            />\n\n            <Button variant=\"primary\" type=\"submit\" value=\"Submit\" block>\n              新增\n            </Button>\n          </Form>\n        )}\n      </Formik>\n    </div>\n    // <Form>\n    //   <progress value={progress} max=\"100\" />\n    //   <Form.Group>\n    //     <img\n    //       src={url || \"https://via.placeholder.com/300\"}\n    //       alt=\"productImg\"\n    //       height=\"200px\"\n    //     />\n    //     <Form.File\n    //       id=\"exampleFormControlFile1\"\n    //       label=\"選取圖片\"\n    //       onChange={handleImgDisplay}\n    //     />\n    //     <Button variant=\"danger\" type=\"button\" onClick={handleUpload}>\n    //       新增\n    //     </Button>\n    //   </Form.Group>\n    //   <Form.Group controlId=\"productTitle\">\n    //     <Form.Label>產品名稱</Form.Label>\n    //     <Form.Control\n    //       onChange={(e) => setTitle(e.currentTarget.value)}\n    //       value={title}\n    //     />\n    //   </Form.Group>\n    //   <Form.Group controlId=\"productCategory\">\n    //     <Form.Label>產品類別</Form.Label>\n    //     <Form.Control\n    //       value={category}\n    //       as=\"select\"\n    //       onChange={(e) => setCategory(e.currentTarget.value)}\n    //     >\n    //       {categories.map((category) => (\n    //         <option key={category}>{category}</option>\n    //       ))}\n    //     </Form.Control>\n    //   </Form.Group>\n    //   <Form.Group controlId=\"productPrice\">\n    //     <Form.Label>原價</Form.Label>\n    //     <Form.Control\n    //       value={price}\n    //       type=\"number\"\n    //       onChange={(e) => setPrice(e.currentTarget.value)}\n    //     />\n    //   </Form.Group>\n    //   <Form.Group controlId=\"productXPrice\">\n    //     <Form.Label>特價</Form.Label>\n    //     <Form.Control\n    //       value={xPrice}\n    //       type=\"number\"\n    //       placeholder=\"無特價請空白\"\n    //       onChange={(e) => setXPrice(e.currentTarget.value)}\n    //     />\n    //   </Form.Group>\n    //   <Button variant=\"primary\" type=\"button\" onClick={handleSubmit} block>\n    //     確認變更\n    //   </Button>\n    // </Form>\n  );\n};\n\nexport default EditForm;\n"]},"metadata":{},"sourceType":"module"}