{"ast":null,"code":"var _jsxFileName = \"/Users/Cooper/Bluxury_Catering/v4-bluxury-catering/src/contexts/CartContext.jsx\";\nimport React, { createContext, useReducer } from \"react\";\nimport { CartReducer, sumItems } from \"./CartReducer\";\nimport firebase, { auth } from \"../services/firebase\";\nexport const CartContext = createContext();\nconst storage = localStorage.getItem(\"cart\") ? JSON.parse(localStorage.getItem(\"cart\")) : [];\nconst initialState = {\n  cartItems: storage,\n  ...sumItems(storage),\n  checkout: false\n};\n\nconst CartContextProvider = ({\n  children\n}) => {\n  const [state, dispatch] = useReducer(CartReducer, initialState);\n\n  const increase = payload => {\n    dispatch({\n      type: \"INCREASE\",\n      payload\n    });\n  };\n\n  const decrease = payload => {\n    dispatch({\n      type: \"DECREASE\",\n      payload\n    });\n  };\n\n  const addProduct = payload => {\n    dispatch({\n      type: \"ADD_ITEM\",\n      payload\n    });\n  };\n\n  const removeProduct = payload => {\n    dispatch({\n      type: \"REMOVE_ITEM\",\n      payload\n    });\n  };\n\n  const clearCart = () => {\n    dispatch({\n      type: \"CLEAR\"\n    });\n  };\n\n  const makeid = length => {\n    let result = \"\";\n    const characters = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    const charactersLength = characters.length;\n\n    for (var i = 0; i < length; i++) {\n      result += characters.charAt(Math.floor(Math.random() * charactersLength));\n    }\n\n    return result;\n  };\n\n  var today = new Date();\n  var date = today.getFullYear() + \"/\" + (\"0\" + (today.getMonth() + 1)).slice(-2) + \"/\" + (\"0\" + today.getDate()).slice(-2);\n  var time = (\"0\" + today.getHours()).slice(-2) + \":\" + (\"0\" + today.getMinutes()).slice(-2) + \":\" + (\"0\" + today.getSeconds()).slice(-2);\n\n  const handleCheckout = () => {\n    alert(\"即將跳轉付款介面。。。\\n清妥善填寫交易訊息，付款後請至您的電子信箱確認訂單狀況。\\n感謝您購買本站商品，如有任何問題歡迎聯繫客服詢問。\");\n    window.location.href = \"/home\";\n    console.log(\"CHECKOUT\", state);\n    var merchantTradeNo = makeid(20);\n    var merchantTradeDate = date + \" \" + time;\n    var totalAmount = state.total.toString();\n    var itemName = state.cartItems.map(cartItem => \"#\" + cartItem.title + \"*\" + cartItem.quantity).toString();\n    const order = {\n      MerchantTradeNo: merchantTradeNo,\n      MerchantTradeDate: merchantTradeDate,\n      TotalAmount: totalAmount,\n      TradeDesc: \"測試交易描述\",\n      ItemName: itemName,\n      ReturnURL: \"http://192.168.0.1\",\n      ClientBackURL: \"http://localhost:3000/home\"\n    };\n    fetch(\"http://localhost:5000/pay\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\"\n      },\n      body: JSON.stringify(order)\n    }).then(() => console.log(\"Order Created\"));\n    console.log(order);\n    window.open(\"http://localhost:5000/payment\");\n    dispatch({\n      type: \"CHECKOUT\"\n    });\n    var consumer = \"\";\n\n    if (auth.currentUser) {\n      consumer = auth.currentUser.uid;\n    }\n\n    const purchaseDate = firebase.firestore.Timestamp.fromDate(new Date()).toDate();\n    firebase.firestore().collection(\"consumption\").doc(purchaseDate.toString()).set({\n      items: state,\n      purchaseDate: purchaseDate,\n      merchantTradeNo: merchantTradeNo,\n      consumer: consumer\n    });\n  };\n\n  const contextValues = {\n    removeProduct,\n    addProduct,\n    increase,\n    decrease,\n    clearCart,\n    handleCheckout,\n    ...state\n  };\n  return /*#__PURE__*/React.createElement(CartContext.Provider, {\n    value: contextValues,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 5\n    }\n  }, children);\n};\n\nexport default CartContextProvider;","map":{"version":3,"sources":["/Users/Cooper/Bluxury_Catering/v4-bluxury-catering/src/contexts/CartContext.jsx"],"names":["React","createContext","useReducer","CartReducer","sumItems","firebase","auth","CartContext","storage","localStorage","getItem","JSON","parse","initialState","cartItems","checkout","CartContextProvider","children","state","dispatch","increase","payload","type","decrease","addProduct","removeProduct","clearCart","makeid","length","result","characters","charactersLength","i","charAt","Math","floor","random","today","Date","date","getFullYear","getMonth","slice","getDate","time","getHours","getMinutes","getSeconds","handleCheckout","alert","window","location","href","console","log","merchantTradeNo","merchantTradeDate","totalAmount","total","toString","itemName","map","cartItem","title","quantity","order","MerchantTradeNo","MerchantTradeDate","TotalAmount","TradeDesc","ItemName","ReturnURL","ClientBackURL","fetch","method","headers","Accept","body","stringify","then","open","consumer","currentUser","uid","purchaseDate","firestore","Timestamp","fromDate","toDate","collection","doc","set","items","contextValues"],"mappings":"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","sourcesContent":["import React, { createContext, useReducer } from \"react\";\nimport { CartReducer, sumItems } from \"./CartReducer\";\nimport firebase, { auth } from \"../services/firebase\";\n\nexport const CartContext = createContext();\n\nconst storage = localStorage.getItem(\"cart\")\n  ? JSON.parse(localStorage.getItem(\"cart\"))\n  : [];\nconst initialState = {\n  cartItems: storage,\n  ...sumItems(storage),\n  checkout: false,\n};\n\nconst CartContextProvider = ({ children }) => {\n  const [state, dispatch] = useReducer(CartReducer, initialState);\n\n  const increase = (payload) => {\n    dispatch({ type: \"INCREASE\", payload });\n  };\n\n  const decrease = (payload) => {\n    dispatch({ type: \"DECREASE\", payload });\n  };\n\n  const addProduct = (payload) => {\n    dispatch({ type: \"ADD_ITEM\", payload });\n  };\n\n  const removeProduct = (payload) => {\n    dispatch({ type: \"REMOVE_ITEM\", payload });\n  };\n\n  const clearCart = () => {\n    dispatch({ type: \"CLEAR\" });\n  };\n\n  const makeid = (length) => {\n    let result = \"\";\n    const characters =\n      \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789\";\n    const charactersLength = characters.length;\n    for (var i = 0; i < length; i++) {\n      result += characters.charAt(Math.floor(Math.random() * charactersLength));\n    }\n    return result;\n  };\n\n  var today = new Date();\n  var date =\n    today.getFullYear() +\n    \"/\" +\n    (\"0\" + (today.getMonth() + 1)).slice(-2) +\n    \"/\" +\n    (\"0\" + today.getDate()).slice(-2);\n  var time =\n    (\"0\" + today.getHours()).slice(-2) +\n    \":\" +\n    (\"0\" + today.getMinutes()).slice(-2) +\n    \":\" +\n    (\"0\" + today.getSeconds()).slice(-2);\n\n  const handleCheckout = () => {\n    alert(\n      \"即將跳轉付款介面。。。\\n清妥善填寫交易訊息，付款後請至您的電子信箱確認訂單狀況。\\n感謝您購買本站商品，如有任何問題歡迎聯繫客服詢問。\"\n    );\n    window.location.href = \"/home\";\n    console.log(\"CHECKOUT\", state);\n    var merchantTradeNo = makeid(20);\n    var merchantTradeDate = date + \" \" + time;\n    var totalAmount = state.total.toString();\n    var itemName = state.cartItems\n      .map((cartItem) => \"#\" + cartItem.title + \"*\" + cartItem.quantity)\n      .toString();\n    const order = {\n      MerchantTradeNo: merchantTradeNo,\n      MerchantTradeDate: merchantTradeDate,\n      TotalAmount: totalAmount,\n      TradeDesc: \"測試交易描述\",\n      ItemName: itemName,\n      ReturnURL: \"http://192.168.0.1\",\n      ClientBackURL: \"http://localhost:3000/home\",\n    };\n    fetch(\"http://localhost:5000/pay\", {\n      method: \"POST\",\n      headers: {\n        \"Content-Type\": \"application/json\",\n        Accept: \"application/json\",\n      },\n      body: JSON.stringify(order),\n    }).then(() => console.log(\"Order Created\"));\n    console.log(order);\n    window.open(\"http://localhost:5000/payment\");\n    dispatch({ type: \"CHECKOUT\" });\n    var consumer = \"\";\n    if (auth.currentUser) {\n      consumer = auth.currentUser.uid;\n    }\n    const purchaseDate = firebase.firestore.Timestamp.fromDate(\n      new Date()\n    ).toDate();\n    firebase\n      .firestore()\n      .collection(\"consumption\")\n      .doc(purchaseDate.toString())\n      .set({\n        items: state,\n        purchaseDate: purchaseDate,\n        merchantTradeNo: merchantTradeNo,\n        consumer: consumer,\n      });\n  };\n\n  const contextValues = {\n    removeProduct,\n    addProduct,\n    increase,\n    decrease,\n    clearCart,\n    handleCheckout,\n    ...state,\n  };\n\n  return (\n    <CartContext.Provider value={contextValues}>\n      {children}\n    </CartContext.Provider>\n  );\n};\n\nexport default CartContextProvider;\n"]},"metadata":{},"sourceType":"module"}